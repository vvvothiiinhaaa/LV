<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <link rel="stylesheet" href="../css/style-TrangChuTrangChu.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
    <link rel="stylesheet" href="./css/style-product.css">
</head>
<body>
    <!-- header -->
    <header>
      <nav class="navbar section-content">
              <a href="TrangChuPettie.html" class="nav-logo">
                  <h2 class="logo-text">Pettie</h2>
              </a>
              <ul class="nav-menu">
                  <button id="menu-close-button" class="fas fa-times"></button>
                  <li class="nav-item">
                      <a href="#" class="nav-link">Trang Chủ</a>
                  </li>
                  <li class="nav-item">
                      <a href="#shop" class="nav-link">Cửa Hàng</a>
                  </li>
                  <li class="nav-item">
                      <a href="#service" class="nav-link">Dịch Vụ</a>
                  </li>
                  <li class="nav-item">
                      <a href="#veter" class="nav-link">Phòng Khám</a>
                  </li>
                  <!-- <li class="nav-item">
                      <a href="#" class="nav-link">Giới Thiệu</a>
                  </li> -->
                  <li class="nav-item">
                    <a href="#" class="nav-link">Đăng Nhập</a>
                </li>
              </ul>
      <button id="menu-open-button" class="fas fa-bars"></button>
  
      </nav>
    </header>    
    <main>
      <section class="product-detailt-section">
        <div class="nav-bar">

        </div>
        <div class="product-detailt-content">

          <div class="product-details" id="product-details">
          <!-- hình ảnh chi tiết sản phẩmphẩm -->
            <div class="product-gallery">
              <!-- Ảnh lớn -->
              <div class="main-img-wrapper">
                  <img id="mainImage" alt="Main Product Image">
              </div>
          
              <!-- Hàng ảnh nhỏ -->
              <div class="small-img-row" id="smallImgRow">
                  <!-- Ảnh nhỏ sẽ được thêm từ JavaScript -->
              </div>

            

          </div>
          
          </div>

            <div class="product-image-wrapper">
                <!-- Chứa thông tin chi tiết sản phẩm -->
                <h1 id="product-name" class="product-title">Tên sản phẩm</h1>
                <div id="product-detailt-img" class="product-detailt-img"></div>
                
                <p id="product-price" class="product-price">Giá: 0 VND</p>
                <p id="product-description" class="product-description">Mô tả sản phẩm</p>
                <!-- chọn kích Thước -->
                 <!-- Chọn trọng lượng sản phẩm -->
                  <div class="product-weight">
                    <h4 class="weight">Trọng lượng:</h4>
                    <div id="weight-buttons" class="weight-buttons">
                        <!-- Các button sẽ được thêm động từ API -->
                    </div>
                  </div>

                 <!-- Chọn số lượng sản phẩm -->
               <!-- Chọn số lượng sản phẩm -->
                <div class="quantity">
                  <h4 class="weight">Số Lượng   :</h4>
                  <div class="add flex1">
                  <span id="decrement">-</span>
                  <label id="quantity">1</label>
                  <span id="increment">+</span>
                </div>
                </div>
                

                <!-- Nút mua -->
                 <div class="buy">
                  <button class="button" id="buy-button" onclick="selectButton(this)">Mua ngay</button>
                  <button  class="button" id="cart-button" onclick="selectButton(this)">Thêm vào giỏ hàng</button>
                 </div>
                
            </div>
            
        </div>
        <div class="descrip-info-use">
          <div class="descrip-info-use-btn">
              <button class="description-btn" data-action="description">Mô tả sản phẩm chi tiết</button>
              <button class="description-btn" data-action="ingredients">Thành phần</button>
              <button class="description-btn" data-action="preservation">Hướng dẫn bảo quản</button>
              <button class="description-btn" data-action="feeding">Hướng dẫn cho ăn</button>
          </div>
          <div class="descrip-info-use-content">
              <!-- chứa nội dung khi chọn buttons -->
          </div>
      </div>
  
    </section>
    <!-- section chứa sản phẩm tương tự -->
    <section>

    </section>
    
         <!-- contact -->
          <section class="contact-section">
            <h2 class="section-title">Liên hệ với chúng tôi</h2>
            <div class="section-content">
              <ul class="contact-info-list">
                <li class="contact-info">
                  <i class="fa-solid fa-location-crosshairs"></i>
                  <p>Đường 3/2, Phường Xuân Khánh, Quận Ninh Kiều, Cần Thơ</p>
                </li>
                <li class="contact-info">
                  <i class="fa-regular fa-envelope"></i>
                  <p>pettieforpet@gmail.com</p>
                </li>
                <li class="contact-info">
                  <i class="fa-solid fa-phone"></i>
                  <p>0332219197</p>
                </li>
                <li class="contact-info">
                  <i class="fa-regular fa-clock"></i>
                  <p>Moday - Sunday : 10:00 AM - 10:00 PM</p>
                </li>
              
                </li>
              </ul>

              <form action="#" class="contact-form">
                <input type="text" class="form-input"  placeholder="Tên của bạn" required>
                <input type="email" class="form-input"  placeholder="Email của bạn" required>
                <textarea name="#" class="form-input" placeholder="Lời nhắn của bạn" required></textarea>
                <button class="submit-button">Gửi</button>
              </form>
            </div>
          </section>
         <!-- footer -->

        
             </main>
                <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

                <script>
                  // Lấy tham số id từ URL
                  const urlParam = new URLSearchParams(window.location.search);
                  const productIds = urlParam.get("id");
                
                  if (productIds) {
                        fetch(`/api/images/img/${productIds}`) // Gọi API với tham số id
                          .then(response => {
                            if (!response.ok) {
                              throw new Error(`Lỗi API: ${response.status}`);
                            }
                            return response.json(); // Chuyển đổi dữ liệu thành JSON
                          })
                          .then(data => {
                         
                            const smallImgRow = document.getElementById('smallImgRow'); // Hàng ảnh nhỏ

                            // Kiểm tra nếu có mảng 'images'
                            if (data.images && Array.isArray(data.images)) {
                              // Gán ảnh đầu tiên làm ảnh lớn mặc định
                              if (data.images.length > 0) {
                                mainImage.src = data.images[0];
                              }

                              data.images.forEach(imageUrl => {
                                const smallImg = document.createElement('img');
                                smallImg.src = imageUrl; // Đường dẫn hình ảnh nhỏ
                                smallImg.alt = 'Ảnh nhỏ sản phẩm';
                                smallImg.className = 'small-img';

                                // Thêm sự kiện click để thay đổi ảnh lớn
                                smallImg.onclick = () => {
                                  mainImage.src = imageUrl;
                                };

                                smallImgRow.appendChild(smallImg);
                              });
                            } else {
                              console.error('Không tìm thấy mảng images trong dữ liệu API');
                            }
                          })
                          .catch(error => {
                            console.error('Lỗi khi tải dữ liệu hình ảnh:', error);
                          });
                      } else {
                        console.error('Không tìm thấy tham số id trong URL.');
                      }

                                


                  //lấy api cho des-info-use

                  const button = document.querySelectorAll('.description-btn');
                  const contentDiv = document.querySelector('.descrip-info-use-content');
               
                  // Hàm gọi API và cập nhật nội dung
                  const fetchAndDisplayContent = async (action) => {
                      try {
                          const response = await fetch(`/api/products/${productId}`);
                          if (!response.ok) {
                              throw new Error('Lỗi khi lấy dữ liệu từ API');
                          }
                          const data = await response.json();

                          // Xác định nội dung tương ứng dựa vào action
                          let content = '';
                          switch (action) {
                              case 'description':
                                  content = data.description || 'Không có mô tả sản phẩm';
                                  break;
                              case 'ingredients':
                                  content = data.component || 'Không có thành phần';
                                  break;
                              // case 'preservation':
                              //     content = data.preservation || 'Không có hướng dẫn bảo quản';
                              //     break;
                              // case 'feeding':
                              //     content = data.feeding || 'Không có hướng dẫn cho ăn';
                              //     break;
                              default:
                                  content = 'Nội dung không xác định';
                          }

                          // Hiển thị nội dung trong contentDiv
                          contentDiv.textContent = content;
                      } catch (error) {
                          console.error('Fetch error:', error);
                          contentDiv.textContent = 'Đã xảy ra lỗi khi tải nội dung.';
                      }
                  };

                  // Gán sự kiện click cho từng button
                  button.forEach((button) => {
                      button.addEventListener('click', () => {
                          const action = button.getAttribute('data-action');
                          fetchAndDisplayContent(action);
                      });
                  });
                </script>
                

                <script>
                  // Lấy ID từ URL
                  const urlParams = new URLSearchParams(window.location.search);
                  const productId = urlParams.get("id");
          
                  // Gọi API để lấy chi tiết sản phẩm
                  if (productId) {
                      fetch(`http://localhost:8080/api/products/${productId}`)
                          .then(response => {
                              if (!response.ok) {
                                  throw new Error("Không thể lấy dữ liệu sản phẩm");
                              }
                              return response.json();
                          })
                          .then(data => {
                              // Cập nhật thông tin trên trang
                              document.getElementById("product-name").innerText = data.name;
                              document.getElementById("product-description").innerText = data.description;
                              document.getElementById("product-price").innerText = formatPrice(data.price) + " VND";
                              document.getElementById("mainImage").src = data.url || "default-image.png";
                          })
                          .catch(error => {
                              console.error("Lỗi:", error);
                              alert("Không thể tải dữ liệu sản phẩm.");
                          });
                  } else {
                      console.error("Không tìm thấy ID sản phẩm trong URL");
                  }
          
                  // Hàm định dạng giá tiền
                  function formatPrice(price) {
                      return new Intl.NumberFormat('vi-VN').format(price);
                  }
              </script>
              <script>
                  // js tăng giảm số lượng
                    // Lấy các phần tử từ DOM
                  const decrementBtn = document.getElementById('decrement');
                  const incrementBtn = document.getElementById('increment');
                  const quantityLabel = document.getElementById('quantity');

                  // Chuyển đổi giá trị hiện tại thành số
                  let quantity = parseInt(quantityLabel.textContent);

                  // Hàm giảm số lượng
                  decrementBtn.addEventListener('click', () => {
                    if (quantity > 1) { // Giới hạn không xuống dưới 1
                      quantity--;
                      quantityLabel.textContent = quantity;
                    }
                  });

                  // Hàm tăng số lượng
                  incrementBtn.addEventListener('click', () => {
                    quantity++;
                    quantityLabel.textContent = quantity;
                  });
              </script>
              <script>
                const swiper = new Swiper('.slider-wrapper', {

                    loop: true,
                    spaceBetween:25,

                    // If we need pagination
                    pagination: {
                      el: '.swiper-pagination',
                      clickable:true,
                      dynamicBullets:true,
                    },

                    // Navigation arrows
                    navigation: {
                      nextEl: '.swiper-button-next',
                      prevEl: '.swiper-button-prev',
                    },
              
                    });


                    // lấy trọng lượng và giá tiền tương ứng
                    // Lấy ID từ URL
                      // Lấy các phần tử DOM
                      const weightButtonsContainer = document.getElementById("weight-buttons");
                      const priceLabel = document.getElementById("product-price");

                      // Hàm gọi API lấy danh sách trọng lượng và giá
                      function fetchProductWeights(productId) {
                          fetch(`http://localhost:8080/api/productweights/${productId}`)
                              .then(response => {
                                  if (!response.ok) {
                                      throw new Error("Không thể lấy danh sách trọng lượng.");
                                  }
                                  return response.json();
                              })
                              .then(weights => {
                                  // Xóa các button cũ
                                  weightButtonsContainer.innerHTML = "";

                                  // Thêm button mới cho từng trọng lượng
                                  weights.forEach(weight => {
                                      const button = document.createElement("button");
                                      button.className = "weight-button";
                                      button.textContent = `${weight.weight}g`;
                                      button.setAttribute("data-price", weight.price);
                                      button.setAttribute("data-weight", weight.weight);

                                      // Thêm sự kiện click để cập nhật giá
                                      button.addEventListener("click", () => {
                                          updatePrice(weight.price);
                                          highlightSelectedButton(button);
                                      });

                                      weightButtonsContainer.appendChild(button);
                                  });

                                  // Chọn trọng lượng đầu tiên mặc định
                                  const firstButton = weightButtonsContainer.querySelector(".weight-button");
                                  if (firstButton) {
                                      firstButton.click();
                                  }
                              })
                              .catch(error => console.error("Lỗi:", error));
                                }

                                // Hàm cập nhật giá tiền
                                function updatePrice(price) {
                                    priceLabel.textContent = formatPrice(price) + " VND";
                                }

                                // Hàm highlight button được chọn
                                function highlightSelectedButton(selectedButton) {
                                    document.querySelectorAll(".weight-button").forEach(button => {
                                        button.classList.remove("selected");
                                    });
                                    selectedButton.classList.add("selected");
                                }

                                // Hàm định dạng giá tiền
                                function formatPrice(price) {
                                    return new Intl.NumberFormat("vi-VN").format(price);
                                }

                                // Gọi API khi trang được tải
                                if (productId) {
                                    fetchProductWeights(productId);
                                } else {
                                    console.error("Không tìm thấy ID sản phẩm trong URL.");
                                }

              </script>
              <script>
                // Lấy tất cả các button trong weight-buttons
                const buttons = document.querySelectorAll('.weight-buttons button');
            
                buttons.forEach(button => {
                    button.addEventListener('click', () => {
                        // Xóa class active khỏi tất cả button
                        buttons.forEach(btn => btn.classList.remove('active'));
                        
                        // Thêm class active vào button được click
                        button.classList.add('active');
                    });
                });
            </script>  
            
             <!--csript chọn trọng lượnglượng  -->
            <script>
              function selectButton(clickedButton) {
                    // Lấy tất cả các nút có class 'button'
                    const buttons = document.querySelectorAll('.button');

                    // Xóa class 'active' khỏi tất cả các nút
                    buttons.forEach(button => button.classList.remove('active'));

                    // Thêm class 'active' vào nút được click
                    clickedButton.classList.add('active');
                  }


            </script>          
</body>
</html>


