<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>QUẢN LÝ ĐƠN HÀNG</title>
    <link href="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/style.min.css" rel="stylesheet" />
    <link href="./css/style-employee.css" rel="stylesheet" />
    <link rel="stylesheet" href="./css/database.css">
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>

    <style>
body {
    font-family: 'Arial', sans-serif;
    color: #333333; /* Màu chữ chính */
    margin: 0;
    padding: 0;
}

.container {
    max-width: 1200px;
    margin: 40px auto;
    padding: 30px;
}

h2 {
    text-align: center;
    color: #333333;
    font-size: 2rem;
    margin-bottom: 30px;
}

.row {
    display: flex;
    justify-content: space-between;
    gap: 20px;
    margin-bottom: 25px;
}

.section {
    flex: 1;
    padding: 15px;
    border: 1px solid #ddd; /* Viền cho các section */
}

.section h3 {
    margin-bottom: 10px;
    color: #333333;
    font-size: 1.2rem;
    border-bottom: 2px solid #ddd;
    padding-bottom: 5px;
}

.section p {
    margin: 8px 0;
    font-size: 1rem;
}

.table-container {
    margin-top: 20px;
    overflow-x: auto;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    border: 1px solid #ddd; /* Viền bảng */
    border-radius: 8px;
}

table th, table td {
    padding: 12px;
    text-align: left;
    border: 1px solid #ddd; /* Viền cho các ô trong bảng */
}

table td {
    background-color: #fff; /* Nền trắng cho các ô */
}

table tr:hover {
    background-color: #f1f1f1;
    cursor: pointer;
}

#totalPayment,
#paymentMethod,
#orderStatus {
    font-weight: bold;
    font-size: 1.1rem;
    color: #333333;
}

@media (max-width: 768px) {
    .container {
        padding: 20px;
        margin: 20px;
    }

    .section {
        width: 100%; /* Các phần tử chiếm toàn bộ chiều rộng khi trên màn hình nhỏ */
        margin-bottom: 20px;
    }

    h2 {
        font-size: 1.5rem;
    }

    .section p {
        font-size: 0.9rem;
    }

    table {
        font-size: 0.9rem;
    }
}
/* Đảm bảo các phần tử trong địa chỉ được hiển thị theo dòng ngang */
#provinceCity, #district, #wardSubdistrict, #addressDetail {
    display: inline-block;
    margin-right: 10px; /* Khoảng cách giữa các phần tử */
}

    </style>
</head>
<body class="sb-nav-fixed">
    <!-- Header and Navigation -->
    <nav class="sb-topnav navbar navbar-expand navbar-dark bg-dark">
        <a class="navbar-brand ps-2 text-center" href="index.html">PETTIE</a>
        <button class="btn btn-link btn-sm order-1 order-lg-0 me-4 me-lg-0" id="sidebarToggle" href="#"><i class="fas fa-bars"></i></button>
        <form class="d-none d-md-inline-block form-inline ms-auto me-0 me-md-3 my-2 my-md-0">
            <div class="input-group">
                <input class="form-control" type="text" placeholder="Search for..." aria-label="Search for..." aria-describedby="btnNavbarSearch" />
                <button class="btn btn-primary" id="btnNavbarSearch" type="button"><i class="fas fa-search"></i></button>
            </div>
        </form>
        <ul class="navbar-nav ms-auto ms-md-0 me-3 me-lg-4">
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" id="navbarDropdown" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false"><i class="fas fa-user fa-fw"></i></a>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                    <li><a class="dropdown-item" href="#">Settings</a></li>
                    <li><a class="dropdown-item" href="#">Activity Log</a></li>
                    <li><hr class="dropdown-divider" /></li>
                    <li><a class="dropdown-item" href="#" onclick="handleLogout()">Logout</a></li>
                </ul>
            </li>
        </ul>
    </nav>
    <!-- Sidebar -->
    <div id="layoutSidenav">
        <div id="layoutSidenav_nav">
            <nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
                <div class="sb-sidenav-menu">
                    <div class="nav">
                        <div class="sb-sidenav-menu-heading">Quản lý</div>
                        <a class="nav-link" href="./dashboard-employee.html">
                            <div class="sb-nav-link-icon"><i class="fas fa-box"></i></div>
                            Trang Chủ Nhân Viên
                        </a>
                        <a class="nav-link" href="./staff-product.html">
                            <div class="sb-nav-link-icon"><i class="fas fa-box"></i></div>
                            Quản lý Sản Phẩm
                        </a>
                        <a class="nav-link" href="./staff-service.html">
                            <div class="sb-nav-link-icon"><i class="fas fa-box"></i></div>
                            Quản lý Dịch Vụ
                        </a>
                        <a class="nav-link" href="./staff-order.html">
                            <div class="sb-nav-link-icon"><i class="fas fa-shopping-cart"></i></div>
                            Quản lý đơn hàng
                        </a>
                        <a class="nav-link" href="./staff-appointment.html">
                            <div class="sb-nav-link-icon"><i class="fas fa-calendar-alt"></i></div>
                            Quản lý đặt lịch
                        </a>
                        <a class="nav-link" href="./staff-discount.html">
                            <div class="sb-nav-link-icon"><i class="fas fa-tags"></i></div>
                            Quản lý mã giảm giá
                        </a>
                    </div>
                </div>
            </nav>
        </div>

        <!-- Main Content -->
        <div id="layoutSidenav_content">
            <main>
                <div class="container">
                    <h2>Chi Tiết Đơn Hàng</h2>

                    <!-- Section 1 & 2: Thông tin tài khoản người dùng và địa chỉ nhận hàng nằm trên cùng một hàng -->
                    <div class="row">
                        <div class="section">
                            <h3><strong>Thông Tin Tài Khoản Người Mua</strong></h3>
                            <p><strong>Tên khách hàng:</strong> <span id="customerName"></span></p>
                            <p><strong>Email:</strong> <span id="customerEmail"></span></p>
                            <p><strong>Số điện thoại:</strong> <span id="customerPhone"></span></p>
                        </div>

                        <div class="section">
                            <h3><strong>Thông Tin Địa Chỉ Nhận Hàng</strong></h3>
                            <p><strong>Tên Người Nhận Hàng:</strong> <span id="customerAddress"></span></p>
                            <p><strong>Số điện thoại nhận hàng:</strong> <span id="phoneAddress"></span></p>
                            <p><strong>Địa chỉ nhận hàng:</strong> 
                                <span id="addressDetail"></span>,
                                 <span id="wardSubdistrict"></span>, 
                                <span id="district"></span>, 
                                 <span id="provinceCity"></span>
                                
                            </p>
                        </div>
                        
                    </div>

                    <!-- Section 3: Bảng chi tiết đơn hàng -->
                     <!-- Bảng chi tiết đơn hàng -->
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Hình Ảnh</th>
                        <th>Sản phẩm</th>
                        <th>Số lượng</th>
                        <th>Giá</th>
                        <th>Phương thức thanh toán</th>
                        <th>Trạng thái</th>
                    </tr>
                </thead>
                <tbody id="productList">
                    <!-- Các sản phẩm sẽ được thêm vào đây -->
                    
                </tbody>
                <tfoot id="order-summary">

                </tfoot>
            </table>
        </div>
                </div>
            </main>
        </div>
    </div>

      
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
<script src="./js/employee-logout.js"></script>
<script src="./js/script-employee.js"></script>

<script>
    // Lấy orderId từ URL
const urlParams = new URLSearchParams(window.location.search);
const orderId = urlParams.get('orderId');

// Kiểm tra xem có orderId trong URL không
if (orderId) {
    // Fetch dữ liệu đơn hàng từ API
    fetch(`http://localhost:8080/api/orders/${orderId}`)
        .then(response => response.json())
        .then(order => {
           
    
            // Hiển thị các sản phẩm trong đơn hàng
            const productList = document.getElementById("productList");
            order.items.forEach(item => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${item.id}</td>
                    <td><img src="${item.url}" alt="${item.productName}" style="width:50px"></td>
                    <td>${item.productName}</td>
                    <td>${item.quantity}</td>
                    <td>${formatVND(item.total)}</td>
                    <td>${order.paymentMethod}</td>
                    <td>${order.orderStatus}</td>
                `;
                productList.appendChild(row);
            });

            const orderSummary = document.getElementById('order-summary');
            orderSummary.innerHTML = `
                <tr>
                    <td colspan="5" style="text-align: right; font-weight: bold;">Giảm giá:</td>
                    <td colspan="2">${order.discount} VNĐ</td>
                </tr>
                <tr>
                    <td colspan="5" style="text-align: right; font-weight: bold;">Tổng thanh toán:</td>
                    <td colspan="2">${order.totalPayment} VNĐ</td>
                </tr>
            `;

            // Gọi API lấy thông tin khách hàng
            fetch(`http://localhost:8080/api/auth/info/${order.userId}`)  
                .then(response => response.json())
                .then(userData => {
                    // Điền thông tin khách hàng vào HTML
                    document.getElementById("customerName").textContent = userData.username;
                    document.getElementById("customerEmail").textContent = userData.email;
                    document.getElementById("customerPhone").textContent = userData.phonenumber;
                })
                .catch(error => console.error("Lỗi lấy thông tin khách hàng:", error));
        
            
            // Lấy thông tin userId và addressId từ đơn hàng
            const userId = order.userId;
            const addressId = order.address.addressId;

            // Fetch thông tin địa chỉ từ API
            return fetch(`http://localhost:8080/api/addresses/${userId}/${addressId}`)
                .then(response => response.json())
                .then(address => {
                    // Hiển thị thông tin địa chỉ
                    document.getElementById("customerAddress").textContent = address.recipientName;
                    document.getElementById("phoneAddress").textContent = address.phoneNumber;
                    document.getElementById("provinceCity").textContent = address.provinceCity;
                    document.getElementById("district").textContent = address.district;
                    document.getElementById("wardSubdistrict").textContent = address.wardSubdistrict;
                    document.getElementById("addressDetail").textContent = address.addressDetail;
                   
                });
        })

        .catch(error => console.error("Lỗi lấy dữ liệu đơn hàng:", error));
} else {
    console.error("Không có orderId trong URL.");
}

// Hàm formatVND để hiển thị tiền tệ VND
function formatVND(amount) {
    return amount.toLocaleString('vi-VN') + " VND";
}

</script>
</body>
</html>
